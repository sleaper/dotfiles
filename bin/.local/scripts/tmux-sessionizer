#!/usr/bin/env bash

# Use the first argument if provided; otherwise, select a directory using fzf.
selected="${1:-$(find ~/Documents/code ~/Documents/code/1-2-LS/IJC ~/Documents ~/dotfiles ~/Documents/code/2-2-LS/ ~/Documents/code/2-1-LS -mindepth 1 -maxdepth 1 -type d | fzf)}"

# Exit if nothing was selected.
[[ -z "$selected" ]] && exit 0

# Create a session name from the basename (replace dots with underscores).
session_name=$(basename "$selected" | tr . _)

# If not inside tmux and no tmux server is running, create and attach a new session.
if [[ -z "${TMUX-}" ]] && ! tmux info &>/dev/null; then
    exec tmux new-session -s "$session_name" -c "$selected"
fi

# If the session doesn't exist, create it in the background (ignore error if it exists).
tmux new-session -ds "$session_name" -c "$selected" 2>/dev/null || true

# Switch to the selected session.
tmux switch-client -t "$session_name"
